async function e(e,t){let a=await fetch(e,t);if(a.ok)return a;throw a}function t(e){let t=document.createElement("template");return t.innerHTML=e.trim(),t.content.firstChild}function a(e){return new Promise((e=>setTimeout(e,1500)))}const n=async function(){let t;for(;!t;)t=await e("data.json").then((e=>({data:e.json(),date:e.headers.get("last-modified")}))).catch(a);return t}(),i=n.then((e=>e.data)),l={title:document.querySelector("h1").innerText,origHeader:document.querySelector("header"),main:document.querySelector("main").innerHTML};function r(){alert("Copia el enlace para guardar la selección")}function o(e){e?.preventDefault();let t=e?.currentTarget?.href||location.href;navigator.share?navigator.share({url:t}):navigator.clipboard?navigator.clipboard.writeText(t).then((()=>alert("Enlace copiado al portapapeles"))).catch(r):r()}l.header=n.then((e=>{e.date&&l.origHeader.querySelector(".main-info").insertAdjacentHTML("beforeend",`\n\n<b>Fecha de última actualización</b>: ${new Date(e.date).toLocaleDateString()}`);let t=l.origHeader.innerHTML;return delete l.origHeader,t}));const c=import("https://cdn.jsdelivr.net/npm/@zip.js/zip.js/dist/zip.min.js");async function s(e,t){await c;let a=new zip.ZipWriter(new zip.BlobWriter("application/zip"));await Promise.all(e.map((async e=>a.add(e.path,await e.stream))));let n=URL.createObjectURL(await a.close()),i=document.createElement("a");i.href=n,i.download=`${t}.zip`,document.body.append(i),i.click(),URL.revokeObjectURL(n),i.remove()}let d=new Promise((e=>{document.head.querySelector("[data-id=vegaEmbed]").onload=()=>e()})),p=[];function u(){let e=location.pathname;return e.endsWith("/")?e:e+"/"}const f=i.then((e=>Object.keys(e.mediciones)));async function h(t,a){let[n,i]=t.split(";");n=`${u()}data/${n}.json`,i=i?i.split(","):[];let l=a?(await f).filter((e=>!a.includes(e))):[];if(!i.some((e=>l.some((t=>e.includes(t))))))return n;let r=await e(n).then((e=>e.text())),o=l.map((e=>`indexof(datum.M, '${e}') == -1`)).join(" && ");return JSON.parse(r.replace("true == true",o))}function m(e){let t=e.split(";")[0].split("/");return t[t.length-1]}async function v(e,a,n){let i=await h(a,n);await d;let l=(await vegaEmbed(e,i,{renderer:"canvas",downloadFileName:m(a)})).finalize;n&&function(e,a){let n=t(`<a href="${u()}data/${a.split(";")[0]}.xlsx" target="_blank" rel="noopener" download>Download table</a>`);e.querySelector(".vega-actions").prepend(n)}(e,a),setTimeout((()=>p.push([e,l])),0)}function b(e){if(document.body.contains(e[0]))return!0;e[1]()}async function y(t,a){let n=await h(t,a);"string"==typeof n&&(n=await e(n).then((e=>e.json()))),await d;let i=new vega.View(vega.parse(await vegaLite.compile(n).spec),{renderer:"none"}).finalize();return new Blob([await i.toSVG()]).stream()}function k(e){let t=q(e);return[[...j(t,e).values()].map((e=>[...e.values()])).flat().map((e=>[...e.values()])).flat(2),t.m]}setInterval((function(){p=p.filter(b)}),1e3);let g=!1;let w=!1;async function $(){let a=await i,n=t(`<header class="main-header-container">\n\t\t<a class="home-link" href=" "><i class="fa-solid fa-house"></i></a>\n\t\t<header class="main-header">\n\t\t\t<label for="main-info-checkbox"><h1>${l.title} <span><i class="fa-solid fa-circle-info"></i></span></h1></label>\n\t\t\t<input id="main-info-checkbox" type="checkbox">\n\t\t\t<p class="main-info">${a.infoResultados}</p>\n\t\t</header>\n\t\t<section class="downloads">\n\t\t\t<span><i class="fa-solid fa-download"></i></span>\n\t\t\t<a href="${location.href}">Enlace</a>\n\t\t\t<a role="link">Tablas.zip</a>\n\t\t\t<a role="link">Gráficas.zip</a>\n\t\t</section>\n\t</header>`);n.querySelector(".home-link").onclick=e=>function(e,t){e.preventDefault();let a=q(t);history.pushState(a,""," "),dispatchEvent(new PopStateEvent("popstate",{state:a}))}(e,a);let r=n.querySelectorAll(".downloads > a");return r[0].onclick=o,r[1].onclick=t=>async function(t,a){if(g)return;g=!0,t.target.style.cursor="wait";let n=k(a)[0].map((t=>({path:`${m(t)}.xlsx`,stream:e(`${u()}data/${t.split(";")[0]}.xlsx`).then((e=>e.body))})));await s(n,"Tablas"),t.target.style.cursor="",g=!1}(t,a),r[2].onclick=e=>async function(e,t){if(w)return;w=!0,e.target.style.cursor="wait";let[a,n]=k(t),i=a.map((e=>({path:`${m(e)}.svg`,stream:y(e,n)})));await s(i,"Gráficas"),e.target.style.cursor="",w=!1}(e,a),n}function S(e){let t={};for(let a of Object.values(e.estimadores))for(let[e,n]of Object.entries(a))t[e]=n;return t}function q(e){let t=new URLSearchParams(location.hash.substring(1)),a={};for(let[e,n]of t)a[e]=n.split(" ");return function(e,t){let a=S(t);return!!(e.var&&e.est&&e.seg&&e.m&&e.var.length&&e.est.length&&e.seg.length&&e.m.length&&e.var.every((e=>t.variables[e]))&&e.est.every((e=>a[e]))&&e.seg.every((e=>t.segmentaciones[e]))&&e.m.every((e=>t.mediciones[e])))}(a,e)&&a}function x(e,t,a){let n=e.split(";")[1].split(","),i=a.filter((e=>!t.includes(e)));return n.some((e=>!i.some((t=>e.includes(t)))))}function j(e,t){let a=Object.keys(t.mediciones),n=new Map;for(let i of e.var){let l=t.variables[i].archivos,r=new Map;for(let t of e.est){let n=l[t];if(!n)continue;let i=new Map;for(let t of e.seg){let l=n[t];l&&(l=l.filter((t=>x(t,e.m,a))),l.length&&i.set(t,l))}i.size&&r.set(t,i)}r.size&&n.set(i,r)}return n}async function L(){let e=location.hash,a=t('<main class="results-page"></main>'),n=await i;if(e!=location.hash)return a;let l=q(n);if(!l)return location.hash="",a;let r=j(l,n);if(!r.size)return a.append(t("<p>Ningún estimador seleccionado está disponible para las variables y mediciones seleccionadas.</p>")),a;let c,s=S(n),d=0;if(l.seg.length>1?d=3:l.est.length>1?d=2:l.var.length>1&&(d=1),d>=1){c=t('<h2 class="var-title">Índice de contenidos seleccionados</h2>'),a.append(c);for(let[e,i]of r.entries()){let l=t(`<a class="index-link" role="link"><span>${n.variables[e].nombre}</span></a>`);if(l.onclick=()=>a.querySelector(`#var-${e}`).scrollIntoView(),a.append(l),d>=2)for(let[l,r]of i.entries()){let i=t(`<a class="index-link indent" role="link"><span>${s[l]}</span></a>`);if(i.onclick=()=>a.querySelector(`#var-${e}-est-${l}`).scrollIntoView(),a.append(i),d>=3)for(let i of r.keys()){let r=t(`<a class="index-link indent-2" role="link"><span>${n.segmentaciones[i]}</span></a>`);r.onclick=()=>a.querySelector(`#var-${e}-est-${l}-seg-${i}`).scrollIntoView(),a.append(r)}}}}function p(e){c.scrollIntoView(),e.preventDefault()}function u(){let e=t('<a class="index-back"><i class="fa-solid fa-arrow-turn-up"></i></a>');return e.onclick=p,e}function f(e,a,n,i){let l=t(`<a class="chart-link" href="${"#?"+new URLSearchParams({var:e,est:a,seg:n,m:i.join(" ")}).toString()}" target="_blank"><i class="fa-solid fa-link"></i></a>`);return l.onclick=o,l}for(let[e,i]of r.entries()){let r=t(`<h2 id="var-${e}" class="var-title">Variable seleccionada: ${n.variables[e].nombre}</h2>`);d>=1&&r.append(u()),a.append(r);for(let[r,o]of i.entries()){let i=t(`<label id="var-${e}-est-${r}" for="${e}-${r}" class="est-title"><h2>Estimador seleccionado: ${s[r]} <span><i class="fa-solid fa-circle-info"></i></span></h2></label>`);d>=2&&i.append(u()),a.append(i,t(`<input id="${e}-${r}" type="checkbox">`),t(`<p>${n.descripciones[r]}</p>`));for(let[i,c]of o.entries()){let o=t(`<h2 id="var-${e}-est-${r}-seg-${i}" class="est-title">Segmentación seleccionada: ${n.segmentaciones[i]}</h2>`);d>=3&&o.append(u()),o.append(f(e,r,i,l.m)),a.append(o);for(let e of c){let n=t('<div class="chart-container"><div></div></div>');v(n.querySelector("div"),e,l.m),a.append(n)}}}}return a}async function E(){return t(`<header class="main-header-container main-selection-header">\n\t\t${await l.header}\n\t</header>`)}function T(e,a,n=!1){return t(`<label><input ${a?`name="${a}"`:""} type="checkbox"${n=n?" checked":""}><span>${e}</span></label>`)}function z(e,t){let a=e.querySelector("input"),n=t.map((e=>e.querySelector("input")));function i(){n.every((e=>e.checked))?a.checked=!0:n.some((e=>!e.checked))&&(a.checked=!1)}a.addEventListener("change",(()=>{for(let e of n)e.checked=a.checked}));for(let e of n)e.addEventListener("change",i);i()}function O(e){return[...new FormData(e).keys()]}function D(e,t,a,n){var i;if(i=e.trim(),""==(e=i.normalize("NFKD").replace(/\p{Diacritic}/gu,"").toLowerCase()))t.querySelectorAll("input").forEach((e=>{e.checked=!1}));else{e=e.split(/\s+/);for(let n of t.children){let t=Array.from(n.querySelectorAll("input")),i=t.shift();i.checked=!1;let l=t.shift();l.checked=!0;for(let n of t){let t=a.variables[n.name].texto;e.every((e=>t.includes(e)))?(n.checked=!0,i.checked=!0):(n.checked=!1,l.checked=!1)}}}n()}function A(e){let t=[...e.querySelectorAll("input")];t.some((e=>e.checked))&&(t[0].checked=!0)}async function M(e){let a=t(`<main class="selection-page">${l.main}</main>`),n=0,r=await i,o=new Set(e?Object.values(e).flat():r.activados),c=a.querySelector("#var-selection");for(let[e,a]of Object.entries(r.bloques)){let i=t(`<div>\n\t\t\t<input id="block${++n}-checkbox" type="checkbox">\n\t\t\t<label for="block${n}-checkbox"><span>${e}</span><span><i class="fa-solid fa-play"></i></span></label>\n\t\t</div>`),l=T("Todas"),s=a.map((e=>T(r.variables[e].nombre,e,o.has(e))));z(l,s),i.append(l,...s),A(i),c.append(i)}let s=a.querySelector("#est-selection"),d=T("Todas las tablas");s.append(d);let p=[];for(let[e,a]of Object.entries(r.estimadores)){let i=t(`<div>\n\t\t\t<input id="block${++n}-checkbox" type="checkbox">\n\t\t\t<label for="block${n}-checkbox"><span>${e}</span><span><i class="fa-solid fa-play"></i></span></label>\n\t\t</div>`),l=Object.entries(a).map((e=>T(e[1],e[0],o.has(e[0]))));p.push(...l),i.append(...l),A(i),s.append(i)}z(d,p);let u=a.querySelector("#seg-selection"),f=T("Todas"),h=Object.entries(r.segmentaciones).map((e=>T(e[1],e[0],o.has(e[0]))));z(f,h),u.append(f,...h);let m,v=a.querySelector("#m-selection"),b=T("Todas"),y=Object.entries(r.mediciones).map((e=>T(e[1],e[0],o.has(e[0]))));z(b,y),v.append(b,...y);let k=a.querySelector(".main-button");function g(){m={var:O(c),est:O(s),seg:O(u),m:O(v)},k.disabled=!Object.values(m).every((e=>e.length))}for(let e of a.querySelectorAll("input:not([id])"))e.addEventListener("change",g);k.addEventListener("click",(function(){k.disabled=!0,function(e){let t=new URLSearchParams(Object.entries(e).map((e=>[e[0],e[1].join(" ")])));history.replaceState(e,""),location.hash="?"+t.toString()}(m)})),function(e,t){let a=e.querySelectorAll(".distr-link > span:last-of-type"),n=[t.descripciones.evolution,t.descripciones.distribution];for(let e=0;e<a.length;e++)a[e].onclick=function(t){t.preventDefault(),alert(n[e])}}(a,r);let w=a.querySelector(".selection-search input");return w.addEventListener("input",(()=>D(w.value,c,r,g))),w.value&&D(w.value,c,r,g),g(),a}function H(){let e=t('<main class="results-page">\n\t\t<label for="evolution-checkbox" class="est-title"><h2>Descripción de las mediciones <span><i class="fa-solid fa-circle-info"></i></span></h2></label>\n\t\t<input id="evolution-checkbox" type="checkbox">\n\t\t<p>Cargando...</p>\n\t\t<div class="chart-container"><div></div></div>\n\t</main>');return v(e.querySelector(".chart-container > div"),"evolution"),i.then((t=>e.querySelector("p").innerHTML=t.descripciones.evolution)),e}let R=0;async function P(e){scrollTo(0,0);const a=R=(R+1)%Number.MAX_SAFE_INTEGER;let n,i,r=location.hash,o=e?.state;r.length>1&&"?"==r[1]?[n,i]=[$(),L()]:[n,i]="#/evolution"==r?[t(`<header class="main-header">\n\t\t<a href="#"><h1>${l.title}</h1></a>\n\t</header>`),H()]:[E(),M(o)],[n,i]=await Promise.all([n,i]),a==R&&(document.querySelector("header").replaceWith(n),document.querySelector("main").replaceWith(i))}window.onpopstate=P,P();
