async function e(e,t){let a=await fetch(e,t);if(a.ok)return a;throw a}function t(e){let t=document.createElement("template");return t.innerHTML=e.trim(),t.content.firstChild}function a(e){return new Promise(e=>setTimeout(e,1500))}const n=async function(){let t;for(;!t;)t=await e("data.json").then(e=>({data:e.json(),date:e.headers.get("last-modified")})).catch(a);return t}(),i=n.then(e=>e.data),l={title:document.querySelector("h1").innerText,origHeader:document.querySelector("header"),main:document.querySelector("main").innerHTML};function r(){alert("Copia el enlace para guardar la selecci\xf3n")}function o(e){e?.preventDefault();let t=e?.currentTarget?.href||location.href;navigator.share?navigator.share({url:t}):navigator.clipboard?navigator.clipboard.writeText(t).then(()=>alert("Enlace copiado al portapapeles")).catch(r):r()}l.header=n.then(e=>{e.date&&l.origHeader.querySelector(".main-info").insertAdjacentHTML("beforeend",`

<b>Fecha de \xfaltima actualizaci\xf3n</b>: ${new Date(e.date).toLocaleDateString()}`);let t=l.origHeader.innerHTML;return delete l.origHeader,t});const c=import("https://cdn.jsdelivr.net/npm/@zip.js/zip.js/dist/zip.min.js");async function s(e,t){await c;let a=new zip.ZipWriter(new zip.BlobWriter("application/zip"));await Promise.all(e.map(async e=>a.add(e.path,await e.stream)));let n=URL.createObjectURL(await a.close()),i=document.createElement("a");i.href=n,i.download=`${t}.zip`,document.body.append(i),i.click(),URL.revokeObjectURL(n),i.remove()}let d=new Promise(e=>{document.head.querySelector("[data-id=vegaEmbed]").onload=()=>e()}),p=[];function u(){let e=location.pathname;return e.endsWith("/")?e:e+"/"}const f=i.then(e=>Object.keys(e.mediciones));async function h(t,a){let[n,i]=t.split(";");n=`${u()}data/${n}.json`,i=i?i.split(","):[];let l=a?(await f).filter(e=>!a.includes(e)):[];if(!i.some(e=>l.some(t=>e.includes(t))))return n;let r=await e(n).then(e=>e.text()),o=l.map(e=>`indexof(datum.M, '${e}') == -1`).join(" && ");return JSON.parse(r.replace("true == true",o))}function m(e){let t=e.split(";")[0].split("/");return t[t.length-1]}async function v(e,a,n){let i=await h(a,n);await d;let l=(await vegaEmbed(e,i,{renderer:"canvas",downloadFileName:m(a)})).finalize;n&&function(e,a){let n=`${u()}data/${a.split(";")[0]}.xlsx`,i=t(`<a href="${n}" target="_blank" rel="noopener" download>Download table</a>`);e.querySelector(".vega-actions").prepend(i)}(e,a),setTimeout(()=>p.push([e,l]))}function b(e){if(document.body.contains(e[0]))return!0;e[1]()}async function y(t,a){let n=await h(t,a);"string"==typeof n&&(n=await e(n).then(e=>e.json())),await d;let i=new vega.View(vega.parse(await vegaLite.compile(n).spec),{renderer:"none"}).finalize();return new Blob([await i.toSVG()]).stream()}function k(e){let t=j(e);return[[...L(t,e).values()].map(e=>[...e.values()]).flat().map(e=>[...e.values()]).flat(2),t.m]}setInterval(function(){p=p.filter(b)},1e3);let g=!1;async function w(t,a){if(g)return;g=!0,t.target.style.cursor="wait";let n=k(a)[0].map(t=>({path:`${m(t)}.xlsx`,stream:e(`${u()}data/${t.split(";")[0]}.xlsx`).then(e=>e.body)}));await s(n,"Tablas"),t.target.style.cursor="",g=!1}let $=!1;async function S(e,t){if($)return;$=!0,e.target.style.cursor="wait";let[a,n]=k(t),i=a.map(e=>({path:`${m(e)}.svg`,stream:y(e,n)}));await s(i,"Gr\xe1ficas"),e.target.style.cursor="",$=!1}async function x(){let e=await i,a=t(`<header class="main-header-container">
		<a class="home-link" href=" "><i class="fa-solid fa-house"></i></a>
		<header class="main-header">
			<label for="main-info-checkbox"><h1>${l.title} <span><i class="fa-solid fa-circle-info"></i></span></h1></label>
			<input id="main-info-checkbox" type="checkbox">
			<p class="main-info">${e.infoResultados}</p>
		</header>
		<section class="downloads">
			<span><i class="fa-solid fa-download"></i></span>
			<a href="${location.href}">Enlace</a>
			<a role="link">Tablas.zip</a>
			<a role="link">Gr\xe1ficas.zip</a>
		</section>
	</header>`);a.querySelector(".home-link").onclick=t=>(function(e,t){e.preventDefault();let a=j(t);history.pushState(a,""," "),dispatchEvent(new PopStateEvent("popstate",{state:a}))})(t,e);let n=a.querySelectorAll(".downloads > a");return n[0].onclick=o,n[1].onclick=t=>w(t,e),n[2].onclick=t=>S(t,e),a}function q(e){let t={};for(let a of Object.values(e.estimadores))for(let[e,n]of Object.entries(a))t[e]=n;return t}function j(e){let t,a=new URLSearchParams(location.hash.substring(1)),n={};for(let[e,t]of a)n[e]=t.split(" ");return t=q(e),!!(n.var&&n.est&&n.seg&&n.m&&n.var.length&&n.est.length&&n.seg.length&&n.m.length&&n.var.every(t=>e.variables[t])&&n.est.every(e=>t[e])&&n.seg.every(t=>e.segmentaciones[t])&&n.m.every(t=>e.mediciones[t]))&&n}function L(e,t){let a=Object.keys(t.mediciones),n=new Map;for(let i of e.var){let l=t.variables[i].archivos,r=new Map;for(let t of e.est){let n=l[t];if(!n)continue;let i=new Map;for(let t of e.seg){let l=n[t];l&&(l=l.filter(t=>(function(e,t,a){let n=e.split(";")[1].split(","),i=a.filter(e=>!t.includes(e));return n.some(e=>!i.some(t=>e.includes(t)))})(t,e.m,a))).length&&i.set(t,l)}i.size&&r.set(t,i)}r.size&&n.set(i,r)}return n}async function E(){let e,a=location.hash,n=t('<main class="results-page"></main>'),l=await i;if(a!=location.hash)return n;let r=j(l);if(!r)return location.hash="",n;let c=L(r,l);if(!c.size)return n.append(t(`<p>Ning\xfan estimador seleccionado est\xe1 disponible para las variables y mediciones seleccionadas.</p>`)),n;let s=q(l),d=0;if(r.seg.length>1?d=3:r.est.length>1?d=2:r.var.length>1&&(d=1),d>=1)for(let[a,i]of(e=t(`<h2 class="var-title">\xcdndice de contenidos seleccionados</h2>`),n.append(e),c.entries())){let e=t(`<a class="index-link" role="link"><span>${l.variables[a].nombre}</span></a>`);if(e.onclick=()=>n.querySelector(`#var-${a}`).scrollIntoView(),n.append(e),d>=2)for(let[e,r]of i.entries()){let i=t(`<a class="index-link indent" role="link"><span>${s[e]}</span></a>`);if(i.onclick=()=>n.querySelector(`#var-${a}-est-${e}`).scrollIntoView(),n.append(i),d>=3)for(let i of r.keys()){let r=t(`<a class="index-link indent-2" role="link"><span>${l.segmentaciones[i]}</span></a>`);r.onclick=()=>n.querySelector(`#var-${a}-est-${e}-seg-${i}`).scrollIntoView(),n.append(r)}}}function p(t){e.scrollIntoView(),t.preventDefault()}function u(){let e=t('<a class="index-back"><i class="fa-solid fa-arrow-turn-up"></i></a>');return e.onclick=p,e}for(let[e,a]of c.entries()){let i=t(`<h2 id="var-${e}" class="var-title">Variable seleccionada: ${l.variables[e].nombre}</h2>`);for(let[c,p]of(d>=1&&i.append(u()),n.append(i),a.entries())){let a=t(`<label id="var-${e}-est-${c}" for="${e}-${c}" class="est-title"><h2>Estimador seleccionado: ${s[c]} <span><i class="fa-solid fa-circle-info"></i></span></h2></label>`);for(let[i,s]of(d>=2&&a.append(u()),n.append(a,t(`<input id="${e}-${c}" type="checkbox">`),t(`<p>${l.descripciones[c]}</p>`)),p.entries())){let a=t(`<h2 id="var-${e}-est-${c}-seg-${i}" class="est-title">Segmentaci\xf3n seleccionada: ${l.segmentaciones[i]}</h2>`);for(let l of(d>=3&&a.append(u()),a.append(function(e,a,n,i){let l=new URLSearchParams({var:e,est:a,seg:n,m:i.join(" ")}),r=t(`<a class="chart-link" href="${"#?"+l.toString()}" target="_blank"><i class="fa-solid fa-link"></i></a>`);return r.onclick=o,r}(e,c,i,r.m)),n.append(a),s)){let e=t('<div class="chart-container"><div></div></div>');v(e.querySelector("div"),l,r.m),n.append(e)}}}}return n}async function T(){return t(`<header class="main-header-container main-selection-header">
		${await l.header}
	</header>`)}function z(e,a,n=!1){let i=a?`name="${a}"`:"";return n=n?" checked":"",t(`<label><input ${i} type="checkbox"${n}><span>${e}</span></label>`)}function O(e,t){let a=e.querySelector("input"),n=t.map(e=>e.querySelector("input"));function i(){n.every(e=>e.checked)?a.checked=!0:n.some(e=>!e.checked)&&(a.checked=!1)}for(let e of(a.addEventListener("change",()=>{for(let e of n)e.checked=a.checked}),n))e.addEventListener("change",i);i()}function D(e){return[...new FormData(e).keys()]}function A(e,t,a,n){if(""==(e=e.trim().normalize("NFKD").replace(/\p{Diacritic}/gu,"").toLowerCase()))t.querySelectorAll("input").forEach(e=>{e.checked=!1});else for(let n of(e=e.split(/\s+/),t.children)){let t=Array.from(n.querySelectorAll("input")),i=t.shift();i.checked=!1;let l=t.shift();for(let n of(l.checked=!0,t)){let t=a.variables[n.name].texto;e.every(e=>t.includes(e))?(n.checked=!0,i.checked=!0):(n.checked=!1,l.checked=!1)}}n()}function M(e){let t=[...e.querySelectorAll("input")];t.some(e=>e.checked)&&(t[0].checked=!0)}async function H(e){let a,n=t(`<main class="selection-page">${l.main}</main>`),r=0,o=await i,c=new Set(e?Object.values(e).flat():o.activados),s=n.querySelector("#var-selection");for(let[e,a]of Object.entries(o.bloques)){let n=t(`<div>
			<input id="block${++r}-checkbox" type="checkbox">
			<label for="block${r}-checkbox"><span>${e}</span><span><i class="fa-solid fa-play"></i></span></label>
		</div>`),i=z("Todas"),l=a.map(e=>z(o.variables[e].nombre,e,c.has(e)));O(i,l),n.append(i,...l),M(n),s.append(n)}let d=n.querySelector("#est-selection"),p=z("Todas las tablas");d.append(p);let u=[];for(let[e,a]of Object.entries(o.estimadores)){let n=t(`<div>
			<input id="block${++r}-checkbox" type="checkbox">
			<label for="block${r}-checkbox"><span>${e}</span><span><i class="fa-solid fa-play"></i></span></label>
		</div>`),i=Object.entries(a).map(e=>z(e[1],e[0],c.has(e[0])));u.push(...i),n.append(...i),M(n),d.append(n)}O(p,u);let f=n.querySelector("#seg-selection"),h=z("Todas"),m=Object.entries(o.segmentaciones).map(e=>z(e[1],e[0],c.has(e[0])));O(h,m),f.append(h,...m);let v=n.querySelector("#m-selection"),b=z("Todas"),y=Object.entries(o.mediciones).map(e=>z(e[1],e[0],c.has(e[0])));O(b,y),v.append(b,...y);let k=n.querySelector(".main-button");function g(){a={var:D(s),est:D(d),seg:D(f),m:D(v)},k.disabled=!Object.values(a).every(e=>e.length)}for(let e of n.querySelectorAll("input:not([id])"))e.addEventListener("change",g);k.addEventListener("click",function(){var e;let t;k.disabled=!0,t=new URLSearchParams(Object.entries(e=a).map(e=>[e[0],e[1].join(" ")])),history.replaceState(e,""),location.hash="?"+t.toString()}),function(e,t){let a=e.querySelectorAll(".distr-link > span:last-of-type"),n=[t.descripciones.evolution,t.descripciones.distribution];for(let e=0;e<a.length;e++)a[e].onclick=function(t){t.preventDefault(),alert(n[e])}}(n,o);let w=n.querySelector(".selection-search input");return w.addEventListener("input",()=>A(w.value,s,o,g)),w.value&&A(w.value,s,o,g),g(),n}let R=0;async function P(e){let a,n;scrollTo(0,0);let r=R=(R+1)%Number.MAX_SAFE_INTEGER,o=location.hash,c=e?.state;if(o.length>1&&"?"==o[1])[a,n]=[x(),E()];else if("#/evolution"==o){let e;[a,n]=[t(`<header class="main-header">
		<a href="#"><h1>${l.title}</h1></a>
	</header>`),(v((e=t(`<main class="results-page">
		<label for="evolution-checkbox" class="est-title"><h2>Descripci\xf3n de las mediciones <span><i class="fa-solid fa-circle-info"></i></span></h2></label>
		<input id="evolution-checkbox" type="checkbox">
		<p>Cargando...</p>
		<div class="chart-container"><div></div></div>
	</main>`)).querySelector(".chart-container > div"),"evolution"),i.then(t=>e.querySelector("p").innerHTML=t.descripciones.evolution),e)]}else[a,n]=[T(),H(c)];[a,n]=await Promise.all([a,n]),r==R&&(document.querySelector("header").replaceWith(a),document.querySelector("main").replaceWith(n))}window.onpopstate=P,P();